---
title: "Impacto de la  diabetes mellitus en personas hospitalizadas por COVID19.OLA 1: data 01/01/2020 – 30/06/2020/  OLA 2:01/07/2020 – 31/03/2021 "
author: "Rai Puig & Jordi Real"
website: "https://github.com/USR-DAPCAT/"

date: "`r format(Sys.time(), '%d %B, %Y')`"


output:
  html_document:
    df_print: paged
    toc: true
    toc_float: true
    fig_caption: true
    css: logos_css/usr_styles.css
  pdf_document: default
  word_document: default

---

&nbsp;
<script>
   $(document).ready(function() {
     $head = $('#header');
     $head.prepend('<img src=\"https://www.idiapjgol.org/images/logo.png\" style=\"float: right ;width: 130px;\"/>')
     $head.prepend('<img src=\"https://avatars2.githubusercontent.com/u/57066591?s=200&v=4\" style=\"margin-left:25% ;width: 80px;\"/>')
     $head.prepend('<img src=\"logos_css/logoDAP_Cat.png\" style=\"float: left:1;width: 185px;\"/>')
   });
</script>


<div class="watermark">DRAFT</div>

****



# 0. Estado:

> Des / 2020


Eventos:

&check; Traducir al inglés los gáficos para el artículo a través del Conductor <br/>



> Nov / 2020


Eventos:

&check; Hacer Modelos con interacciones y recalcular modelos con orden de variables <br/>
&check; Añadir complicaciones neurológicas <br/>
&check; Tabla estratificado por sexo para pacientes no diabéticos <br/>
&check; Quitar los fármacos de los modelos <br/>
&check; Arreglar la tabla de laboratorio añadiendo [stringsAsFactors=F] <br/>
&check; Las curvas spline con los nuevos datos <br/>
&check; Añadidos modelos no paramétricos para estudiar efecto no lineal  <br/>
&check; Graficar Splines de glucosa de modelos finales <br/>



**Últimas actualizaciones** 

**Realizado**

> Mayo/Junio/2021

&check; Estudiar las dos olas, a partir de la ultima base de datos abril.2021  <br/>


> Febrero/2021

&check; Mejora de los modelos no paramétricos con término spline(Glucosa)  <br/>

> Setiembre/2020

&check; Ampliar tablas descriptivas P25, Median , P75 etc.. <br/>
&check; Cálculo de nuevas variable IFCC HBA1C, agrupador Comp_cardiovascular <br/>
&check; Calcular y añadir p valores en tabla 2 <br/>
&check; Actualizaciones modelos de mortalidad modelo definitivo <br/>
&check; actualizaciones nuevos modelos de Ventilación Mecánica y/o mortalidad <br/>
&check; Modelos por subgrupos <br/>
&check; Forest plot de modelos <br/>


> Agost/2020

&check; Nuevos modelos de mortalidad  <br/>
&check; Nuevos modelos de Ventilación Mecánica y/o mortalidad <br/>
&check; Comprobar valores de máximos de glucosa basal. <br/>

> Agost/2020

&check; Revisar código (Split script & Review)  <br/>
&check; Canvi de criteri de DM a: HB>=6.5 y/o Glucemia >=200 <br/>
&check; Generar tabla plana <br/>
&check; Nuevos modelos de mortalidad <br/>
&check; Nuevos modelos de ingreso en UCI <br/>

> Juliol/2020

&check; FLOW CHARTS Criterios de Inclusión y Descriptiva GENERAL.Ingresos , Urgencías <br/>
&check; Descriptiva Problemas de salud <br/>
&check; Descriptiva Constantes Vitales <br/>
&check; Descriptiva Laboratorio <br/>
&check; Descriptiva Mediacmentos <br/>
&check; Descriptiva EVENTOS <br/>
&check; Modelos de Mortalidad <br/>

>

&check; Lectura / importación de archivos  <br/>
&check; Generación de conductors   <br/>
&check; Revisión de códigos  <br/>
&check; Agregación de datos segun protocolo <br/>
&check; Cálculo de varibles y recodificaciones <br/>
&check; Descriptiva exploratoria <br/>
&check; FLOW CHARTS Criterios de Inclusión y Descriptiva GENERAL.Ingresos , Urgencías <br/>
&check; Descriptiva Problemas de salud <br/>
&check; Descriptiva Constantes Vitales <br/>
&check; Descriptiva Laboratorio <br/>
&check; Descriptiva Mediacmentos <br/>
&check; Descriptiva EVENTOS <br/>
&check; Modelos de Moeratlidad <br/>

**Pendent**

* Revisión y depuración d'errors 

# Análisis

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = FALSE, message=FALSE, warning=FALSE, include=F,size="huge")

#include = FALSE prevents code and results from appearing in the finished file. R Markdown still runs the code in #the chunk, and the results can be used by other chunks.
#echo = FALSE prevents code, but not the results from appearing in the finished file. This is a useful way to #embed figures.
#message = FALSE prevents messages that are generated by code from appearing in the finished file.
#warning = FALSE prevents warnings that are generated by code from appearing in the finished.
#fig.cap = "..." adds a caption to graphical results.

#06.11.2020

############
#09.09.2020
#16.09.2020
###########

library("dplyr")
library("lubridate")
library("base")
library("frequency")
library("table1")

# load package
library("sjPlot")
library("sjmisc")
library("sjlabelled")
library("mgcViz")

##########
#6.8.2020#
##########

# Funcions 
link_source<-paste0("https://github.com/jrealgatius/Stat_codis/blob/master/funcions_propies.R","?raw=T")
devtools::source_url(link_source)

# directori_dades<-params$dir_dades
#directori_dades<-params$dir_dades

conductor<-here::here("conductor_Covid.xlsx")
conductor_codis2<-here::here("codis_Covid_Agrupadores_juny.xlsx")



# Llanço taula i camp que vull etiquetar i cambia nom del camp en funció d'etiqueta

etiquetar_taula<-function(taula=resumtotal,camp="variable",taulavariables="variables_R.xls",camp_descripcio="descripcio2",idcamp="camp") {
  
  # taula=porca
  # taulavariables=conductor
  # camp="Parameter"
  # camp_descripcio="desc_model"
  # idcamp="camp2"

  ####  Llegir etiquetes i variables a analitzar ####
  variables <- read_conductor(taulavariables)
  camp_sym<-sym(camp)
  idcamp_sym<-sym(camp_sym)

  # Canviar nom de camp de variables al de la taula 
  # colnames(variables)[colnames(variables)=="camp"] <- camp
  colnames(variables)[colnames(variables)==idcamp] <- camp

  # Canviar arguments per ser evaluats
  camp_eval<-sym(camp)
  camp_descripcio_eval<-sym(camp_descripcio)
  # Canviar el format de la taula 
  taula %>% left_join(dplyr::select(variables,c(!!camp_eval,camp_descripcio)),by=quo_name(camp_eval)) %>% 
    rename(descripcio=!!camp_descripcio) %>% 
    mutate(!!camp_eval:=descripcio) %>% 
    dplyr::select(-descripcio)
 
}

# Cambia nom dels elements d'un vector 



```


```{r lectura, include = FALSE}

#canviat 10.V.2021!

load(here::here("COVID3.Rdata"))

```



```{r recodes1}

#TAULA_PLANA




#Hem canviat el Yes!
TAULA_PLANA<-TAULA_PLANA%>%mutate_at(vars(starts_with("DG.") ),funs(ifelse(is.na(.),"No","Yes")))
TAULA_PLANA<-TAULA_PLANA%>%mutate_at(vars(starts_with("DG2.") ),funs(ifelse(is.na(.),"No","Yes")))
TAULA_PLANA<-TAULA_PLANA%>%mutate_at(vars(starts_with("FX.") ),funs(ifelse(is.na(.),"No","Yes")))

TAULA_PLANA<-TAULA_PLANA%>%mutate_at(vars(starts_with("CVD.") ),funs(ifelse(is.na(.),"No","Yes")))

#29.3.2021

TAULA_PLANA<-TAULA_PLANA%>%mutate_at(vars(starts_with("DM1") ),funs(ifelse(is.na(.),"No","Yes")))
TAULA_PLANA<-TAULA_PLANA%>%mutate_at(vars(starts_with("DM2") ),funs(ifelse(is.na(.),"No","Yes")))

#table(TAULA_PLANA$DM1.E10)
#table(TAULA_PLANA$DM2.E11)

#11.5.2021


#TAULA_PLANA<-TAULA_PLANA%>%mutate(RESPIRADOR_MECH_VENT=ifelse(RESPIRADOR_MECH_VENT=="SI","Yes","No")) 

#ull mirar-ho!

#dt_temp<-TAULA_PLANA
#names(dt_temp)
#vector_bo<-c("PATIENT.ID","EDAD.AGE","SEXO.SEX")
#vector_noms<-c("IDINGRESO","EDAD","SEX")
#colnames(dt_temp)[1:3]<-vector_noms





```


```{r recodes2}

TAULA_PLANA<-TAULA_PLANA%>%mutate_at(vars(starts_with("EV1.") ),funs(ifelse(is.na(.),"No","Yes")))
TAULA_PLANA<-TAULA_PLANA%>%mutate_at(vars(starts_with("EV2.") ),funs(ifelse(is.na(.),"No","Yes")))
TAULA_PLANA<-TAULA_PLANA%>%mutate_at(vars(starts_with("EV3.") ),funs(ifelse(is.na(.),"No","Yes")))

TAULA_PLANA<-TAULA_PLANA%>%mutate_at(vars(starts_with("G_DIABETIC") ),funs(ifelse(is.na(.),"No","Yes")))

TAULA_PLANA<-TAULA_PLANA%>%mutate_at(vars(starts_with("Neurologic_Comp") ),funs(ifelse(is.na(.),"No","Yes")))


```


```{r preparacio1, include = FALSE}

#COVID CONFIRMADO

#TAULA_PLANA<-TAULA_PLANA%>%mutate(exclusio1=ifelse(DIAG.ING.INPAT=="COVID19 - POSITIVO",0,1))

#CANVIAT : 10.5.2021
TAULA_PLANA<-TAULA_PLANA%>%mutate(exclusio1=ifelse(DIAG.ING.INPAT=="COVID CONFIRMADO",0,1))
TAULA_PLANA<-TAULA_PLANA%>%mutate(exclusio2=ifelse(EDAD.AGE>18,0,1)) 

TAULA_PLANA$Ad_UCI<-ifelse(is.na(TAULA_PLANA$F_ENTRADA_UC.ICU_DATE_IN),"No","Yes" )
TAULA_PLANA$EDAD.AGE2<- ifelse(TAULA_PLANA$EDAD.AGE<=65,"<=65 años",">65 años")
TAULA_PLANA$EDAD.AGE3<- ifelse(TAULA_PLANA$EDAD.AGE<=55,"<=55 años",">55 años")
TAULA_PLANA$Death<- ifelse(TAULA_PLANA$MOTIVO_ALTA.DESTINY_DISCHARGE_ING=="Fallecimiento","Yes","No")

#PROVA!!

TAULA_PLANA$agecat2<-9999
TAULA_PLANA$agecat2<-ifelse(TAULA_PLANA$EDAD.AGE<40,"0",TAULA_PLANA$agecat2)
TAULA_PLANA$agecat2<-ifelse(TAULA_PLANA$EDAD.AGE>=40 & TAULA_PLANA$EDAD.AGE<=60,"1",TAULA_PLANA$agecat2)
TAULA_PLANA$agecat2<-ifelse(TAULA_PLANA$EDAD.AGE>=61,"2",TAULA_PLANA$agecat2)
#



#table(TAULA_PLANA$agecat2)



```


## 1.Flow Chart



```{r flow_chart, include = TRUE,message = FALSE,warning = FALSE,echo = FALSE}
#flow chartS : eps m'ha fallat!!! 


criteris_exclusio_diagrama(dt=TAULA_PLANA,
                                        taulavariables=conductor,
                                        criteris = "exc_pre",
                                        ordre="exc_ordre",
                                        grups=NA,
                                        etiquetes="descripcio2",
                                        sequencial = T,
                                        pob_lab=c("Covid Data Save Lives","Muestra con Covid positivo"),
                                        colors=c("white","grey"),
                                        forma=c("ellipse","box"))



#criteris_exclusio_diagrama2(dt=TAULA_PLANA,
#                                        taulavariables=conductor,
#                                        criteris = "exc_pre",
#                                        ordre="exc_ordre",
#                                        grups=NA,
#                                        etiquetes="descripcio",
#                                        sequencial = T,
#                                        pob_lab=c("Covid Data Save Lives","Muestra con Covid positivo"),
#                                        colors=c("grey","white"),
#                                        POB=459331 ,
#                                        POB_LAB="SIDIAP:La población de pacientes con DM2 de 2017 aprox: ")
##################################3




criteris_exclusio_diagrama(dt=TAULA_PLANA,
                                      taulavariables=conductor,
                                        criteris = "exc_pre",
                                        ordre="exc_ordre",
                                        grups="G_DIABETIC",
                                        etiquetes="descripcio2",
                                        sequencial = T,
                                        pob_lab=c("Covid Data Save Lives","Muestra con Covid positivo"),
                                        colors=c("white","grey"),
                                        forma=c("ellipse","box"))



#criteris_exclusio_diagrama2(dt=TAULA_PLANA,
#                                        taulavariables=conductor,
#                                        criteris = "exc_pre",
#                                        ordre="exc_ordre",
#                                        grups="G_DIABETIC",
#                                        etiquetes="descripcio2",
#                                        sequencial = T,
#                                        pob_lab=c("Covid Data Save Lives","Muestra con Covid positivo"),
#                                        colors=c("white","grey"),
#                                        POB=2306 ,
#                                        POB_LAB="Covid Data Save Lives ")

# prova!

#criteris_exclusio_diagrama2(dt=TAULA_PLANA,
#                                        taulavariables=conductor,
#                                        criteris = "exc_pre",
#                                        ordre="exc_ordre",
#                                        grups="agecat2",
#                                        etiquetes="descripcio",
#                                        sequencial = T,
#                                        pob_lab=c("Covid Data Save Lives","Muestra con Covid positivo"),
#                                        colors=c("white","grey"),
#                                        POB=2306 ,
#                                        POB_LAB="Covid Data Save Lives ")




```


```{r preparacio3, include = FALSE}

TAULA_PLANA_exc<-criteris_exclusio(TAULA_PLANA,taulavariables=conductor,criteris="exc_pre")


#table(TAULA_PLANA_exc$DM1.E10)
#table(TAULA_PLANA_exc$DM2.E11)

```


```{r preparacio4, include = FALSE}


#table(TAULA_PLANA_exc$GRUP_DIABETIC_CAT)
#table(TAULA_PLANA_exc$GRUP_DIABETIC_CAT2)


TAULA_PLANA_exc<-TAULA_PLANA_exc%>%
  mutate(Death_DG.Mechanical_ventialtion = ifelse(Death == "Yes"| EV1.Mechanical_ventialtion=="Yes" , "Yes", "No"))

TAULA_PLANA_exc<-TAULA_PLANA_exc%>%
  mutate(Death_DG.Mechanical_ventialtion_Ad_UCI = ifelse(Death == "Yes"| EV1.Mechanical_ventialtion=="Yes" | Ad_UCI=="Yes", "Yes", "No"))

TAULA_PLANA_exc<-TAULA_PLANA_exc%>%
  mutate(DG.Mechanical_ventialtion_Ad_UCI = ifelse(EV1.Mechanical_ventialtion=="Yes" | Ad_UCI=="Yes", "Yes", "No"))



```


```{r preparaci5, include=T}

TAULA_PLANA_exc<-TAULA_PLANA_exc%>%mutate(FX.STATINS2=ifelse(FX.STATINS=="Yes" ,"Si","No"))
TAULA_PLANA_exc<-TAULA_PLANA_exc%>%mutate(FX.ARB_ACEI=ifelse( (FX.ARB=="Yes" | FX.ACEI=="Yes") ,"Si","No"))
TAULA_PLANA_exc<-TAULA_PLANA_exc%>%mutate(FX.ARB_ACEI_STATINS=ifelse( (FX.ARB=="Yes" | FX.ACEI=="Yes") & (FX.STATINS=="Yes") ,"Si","No"))
TAULA_PLANA_exc<-TAULA_PLANA_exc%>%mutate(FX.NO_ARB_ACEI_STATINS=ifelse( FX.ARB=="No" & FX.ACEI=="No" & FX.STATINS=="No" ,"Si","No"))

```
## Analisis exploratori GLOBAL 

### Generar grup de fàrmacs excluyents i verificació 

```{r, include=TRUE}
vars_fx<-c("FX.ACEI","FX.STATINS","FX.ARB")
TAULA_PLANA_exc<- TAULA_PLANA_exc %>% tidyr::unite(FX.ACEI_STATINS_ARB,vars_fx,sep="_",remove = F) 

# Capturar variable combinada d'aquests farmacs excloents
popa<-read_conductor(conductor,sheet="COMBI_FARMACOS") %>% select(FX.ACEI_STATINS_ARB,FX.COMBI)

TAULA_PLANA_exc<-TAULA_PLANA_exc %>% 
  left_join(popa,by="FX.ACEI_STATINS_ARB")
# Etiquetar valors
TAULA_PLANA_exc<-TAULA_PLANA_exc %>% etiquetar_valors(variables_factors = conductor,fulla = "COMBI_FARMACOS",camp_etiqueta = "Descripcio")

# Taula de verificació
#descrTable(FX.COMBI ~ FX.ACEI + FX.STATINS + FX.ARB+ FX.ACEI_STATINS_ARB + FX.ARB_ACEI, data= TAULA_PLANA_exc, method = 3, show.p.overall = F) %>% export2md()


rm(popa)

```
### Reclasificació de Diabetis tipus 2, tipus 1 i altres i verificació de classificació 
```{r, include=TRUE}



# Recalcular DM2 en funció de Diagnostic, tractament ADO o basal_HBA1C>=6.5  SENSE QUE SIGUI DM1
# GRUP_DM2 ---> DG.DM2, | FX.ADO | basal_HBA1C>=6.5 
#TAULA_PLANA_exc<-TAULA_PLANA_exc %>% mutate (GRUP_DM2=case_when(
#                                                  DG.DM1=="No" & (DG.DM2=="Yes" | FX.ADO=="Yes") ~ "Yes",
#                                                  DG.DM1=="Yes" & FX.ADO=="Yes" ~ "Yes",
#                                                  DG.DM1=="No" & basal_pacient_valor_HBA1C_>=6.5 ~ "Yes",
#                                                  TRUE ~ "No") ) 
# Reclassificar tipus de diabetis 
#TAULA_PLANA_exc<-
#  TAULA_PLANA_exc %>% mutate(GRUP_DIABETIC_CAT2=case_when(GRUP_DM2=="Yes"~ "2.DM2",
#                                                        DG.DM1=="Yes"~"1.DM1",
#                                                        DG.DM_SEC=="Yes" & GRUP_DM2=="No" & DG.DM1=="No" ~"3.Others DM",
#                                                        TRUE ~ "0.No Diabetes")) 

# Reclassificar altres tipus de DM en funció de GLUCOSA BASAL>=200 O qualsevol tipus de DM, INSULINAS
#TAULA_PLANA_exc<-TAULA_PLANA_exc %>% 
#  mutate(GRUP_DIABETIC_CAT2=case_when(GRUP_DIABETIC_CAT2=="0.No Diabetes" 
#                                      & (FX.INSULINAS_INTM=="Yes" | FX.INSULINAS_LENT=="Yes" | FX.INSULINAS_Rap=="Yes" | #GLU_1>=200)  ~ "3.Others DM", 
#                                        TRUE ~ GRUP_DIABETIC_CAT2 ))



# fet per mantenir el GRUP_DIABETIC_CAT2 anterior no el NOU!.

TAULA_PLANA_exc<-TAULA_PLANA_exc%>% mutate(GRUP_DIABETIC_CAT2=case_when(GRUP_DIABETIC_CAT2==0~"0.No Diabetes",
                                              GRUP_DIABETIC_CAT2==1~"1.DM1",
                                              GRUP_DIABETIC_CAT2==2~"2.DM2",
                                              GRUP_DIABETIC_CAT2==3~"3.Others DM"))




TAULA_PLANA_exc<-TAULA_PLANA_exc%>% mutate(GRUP_DIABETIC_CAT=case_when(GRUP_DIABETIC_CAT==0~"0.No Diabetes",
                                              GRUP_DIABETIC_CAT==1~"1.DM1",
                                              GRUP_DIABETIC_CAT==2~"2.DM2",
                                              GRUP_DIABETIC_CAT==3~"3.Others DM"))


# Reclassificar variable G_DIABETIC 
TAULA_PLANA_exc<-TAULA_PLANA_exc %>% mutate(G_DIABETIC=if_else(GRUP_DIABETIC_CAT2=="0.No Diabetes","No","Yes"))

# Verificar tema 
#descrTable(GRUP_DM2~DG.DM2+ FX.ADO + DG.DM1 + basal_pacient_valor_HBA1C_,
#           data=TAULA_PLANA_exc, 
#           method = 2, Q1=0,Q3=1,
#           show.p.overall = F, show.n = T) %>% export2md()


# Verificar tema 
#descrTable(G_DIABETIC ~ GRUP_DM2+ FX.ADO + DG.DM1 + basal_pacient_valor_HBA1C_,
#           data=TAULA_PLANA_exc, 
#           method = 2, Q1=0,Q3=1,
#           show.p.overall = F, show.n = T) %>% export2md()


# Verificar tema 
#descrTable(G_DIABETIC ~ GRUP_DIABETIC_CAT2,
#           data=TAULA_PLANA_exc, 
#           method = 2, Q1=0,Q3=1,
#           show.p.overall = F, show.n = T) %>% export2md()

# Reclassificar altres DM en funció de GLUCOSA BASAL>=200 O qualsevol tipus de DM, INSULINAS
#descrTable(GRUP_DIABETIC_CAT2 ~ G_DIABETIC + FX.INSULINAS_INTM + FX.INSULINAS_LENT +FX.INSULINAS_Rap + FX.ADO + GLU_1 + basal_pacient_valor_HBA1C_,
#           data=TAULA_PLANA_exc, 
#           method = 2, Q1=0,Q3=1,
#           show.p.overall = F, show.n = T) %>% export2md()



```


```{r taules9, include = FALSE}

TAULA_PLANA_exc$agecat<-9999

TAULA_PLANA_exc$agecat<-ifelse(TAULA_PLANA_exc$EDAD.AGE<20,"0",TAULA_PLANA_exc$agecat)
TAULA_PLANA_exc$agecat<-ifelse(TAULA_PLANA_exc$EDAD.AGE>=20 & TAULA_PLANA_exc$EDAD.AGE<=39
                                               ,"1",TAULA_PLANA_exc$agecat)

TAULA_PLANA_exc$agecat<-ifelse(TAULA_PLANA_exc$EDAD.AGE>=40 & TAULA_PLANA_exc$EDAD.AGE<=59
                                             ,"2",TAULA_PLANA_exc$agecat)

TAULA_PLANA_exc$agecat<-ifelse(TAULA_PLANA_exc$EDAD.AGE>59,"3",TAULA_PLANA_exc$agecat)

TAULA_PLANA_exc$Death2<-ifelse(TAULA_PLANA_exc$Death=="Yes",1,0)

#18.11.2020 HO HE CANVIAT
#TAULA_PLANA_exc$Ad_UCI<-ifelse(TAULA_PLANA_exc$Ad_UCI=="Si",1,0)






```


```{r fusio_dt_general, include=FALSE}

#mirar-ho!! ull parlar amb en Jordi tema etiquetar variables i etiquetar valors?

## Factoritzar
TAULA_PLANA_exc<-TAULA_PLANA_exc%>% mutate_at(extreure.variables("factor",conductor,dt=TAULA_PLANA_exc),as.factor)

## Reetiquetar
TAULA_PLANA_exc<-etiquetar(TAULA_PLANA_exc,taulavariables=conductor, camp_descripcio = "descripcio2")

#07.12.2020
#TAULA_PLANA_exc<-etiquetar_valors(dt=TAULA_PLANA_exc,variables_factors=conductor,fulla="etiquetes",camp_etiqueta="etiqueta1")


TAULA_PLANA_exc_DIAB<-TAULA_PLANA_exc%>%filter(G_DIABETIC=="Yes")
TAULA_PLANA_exc_NO_DIAB<-TAULA_PLANA_exc%>%filter(G_DIABETIC=="No")







```





## 2.Descriptivo general (Población Total i Población DM2)


```{r resultats1, include=T}

#####################################################################################################


formula<-formula.text("Taula00B",y="wave",taulavariables = conductor,dt=TAULA_PLANA_exc)

descrTable(formula,method =2,
           Q1 = 0, Q3 = 1,
           data=TAULA_PLANA_exc,
           max.xlev = 100, 
           show.p.overall=FALSE,
           show.n = TRUE,
           hide.no="No",
           simplify=F) %>% 
  export2md(caption="**TABLA 1a.Tabla desctiptiva de las 2 olas Covid 19.Todos los pacientes.(mediana, min,max,%)**")

#####################################################################################################

descrTable(formula,method =1,
           data=TAULA_PLANA_exc,
           max.xlev = 100, 
           show.p.overall=TRUE,
           show.n = T,
           hide.no="No",
           simplify=F) %>% 
  export2md(caption="**TABLA 1b.Tabla desctiptiva de las 2 olas Covid 19.Todos los pacientes.(media,sd,%)**")




#TAULA_PLANA_exc_b<-TAULA_PLANA_exc%>%filter(GRUP_DIABETIC_CAT2!="0.No Diabetes")
#####################################################################################################
#descrTable(formula,method =2,
#           Q1 = 0, Q3 = 1,
#           data=TAULA_PLANA_exc_b,
#           max.xlev = 100, 
#           show.p.overall=FALSE,
#           show.n = F,
#           hide.no="No",
#           simplify=F) %>% 
#  export2md(caption="**TABLA 2a.Tabla desctiptiva de las 2 olas Covid 19.Todos los pacientes DM.(mediana, min,max,%)**")
#####################################################################################################
#descrTable(formula,method =1,
#           data=TAULA_PLANA_exc_b,
#           max.xlev = 100, 
#           show.p.overall=TRUE,
#           show.n = T,
#           hide.no="No",
#           simplify=F) %>% 
#export2md(caption="**TABLA 2b.Tabla desctiptiva de las 2 olas Covid 19.Todos los pacientes DM.(media,sd,%)**")
#####################################################################################################




TAULA_PLANA_exc_c<-TAULA_PLANA_exc%>%filter(GRUP_DIABETIC_CAT=="2.DM2")



descrTable(formula,method =2,
           Q1 = 0, Q3 = 1,
           data=TAULA_PLANA_exc_c,
           max.xlev = 100, 
           show.p.overall=FALSE,
           show.n = F,
           hide.no="No",
           simplify=F) %>% 
  export2md(caption="**TABLA 3a.Tabla desctiptiva de las 2 olas Covid 19.Todos los pacientes DM2.(mediana, min,max,%)**")

#####################################################################################################

descrTable(formula,method =1,
           data=TAULA_PLANA_exc_c,
           max.xlev = 100, 
           show.p.overall=TRUE,
           show.n = T,
           hide.no="No",
           simplify=F) %>% 
  export2md(caption="**TABLA 3b.Tabla desctiptiva de las 2 olas Covid 19.Todos los pacientes DM2.(media,sd,%)**")





#CVD#

#formula<-formula.text("CVD",y="G_DIABETIC",taulavariables = conductor,dt=TAULA_PLANA_exc) 
#descrTable(formula,method =2,
#           Q1 = 0.25, Q3 = 0.75,
#           data=TAULA_PLANA_exc,
#           max.xlev = 100, 
#           show.p.overall=TRUE,
#           show.n = T,
#           hide.no="No",
#           simplify=F) %>% 
#  export2md(caption="**TABLA CVD.**")

#---------------------------------------#
#CVD<-CVD%>% mutate(PATIENT.ID=idp)
#CVD$PATIENT.ID<-as.double(CVD$PATIENT.ID)
#CVD2<-TAULA_PLANA_exc%>%select(PATIENT.ID)
#CVD2<- CVD2%>%left_join(CVD,by="PATIENT.ID")
#---------------------------------------#
#frq(CVD2$cod_CVD)
#---------------------------------------#



#DIAB_GRUP<-  G_DIABETIC~GRUP_DIABETIC_CAT


#descrTable(DIAB_GRUP,method =1,
#           data=TAULA_PLANA_exc,
#           max.xlev = 100, 
#           show.p.overall=FALSE,
#           show.n = T,
#           simplify=F) %>% 
#  export2md(caption="TABLA 0. Type of DIABETES.")




#formula<-formula.text("Taula01",y="G_DIABETIC",taulavariables = conductor,dt=TAULA_PLANA_exc) 
#formula2<-formula.text("Taula",y="wave",taulavariables = conductor,dt=TAULA_PLANA_exc)

#descrTable(formula,method =2,
#           Q1 = 0.25, Q3 = 0.75,
#           data=TAULA_PLANA_exc,
#           max.xlev = 100, 
#           show.p.overall=TRUE,
#           show.n = T,
#           hide.no="No",
#           simplify=F) %>% 
#  export2md(caption="**TABLA 1a. Registros de pacientes ingresados: Demográficos, datos del episodio del ingreso,  si ha habido, datos del paso por UCI, si ha habido.Todos los pacientes.**")



#############################################
#formula,method =2 (No Paramètric/No normal)#
#############################################


# formula<-formula_table1("Taula01",y="DIAB",taulavariables = conductor,dt=dt_plana_covid1_agr_exc_lab) 
#table1::table1(~EDAD.AGE|G_DIABETIC, 
#               data = TAULA_PLANA_exc,overall="Total",caption="Taula 1a",
#               render.continuous=c(.="Mean (SD)", .="Median [Q1, Q3]"))

# Genero filtre dades solament urgencies
#TAULA_PLANA_exc2<-TAULA_PLANA_exc%>%filter(URG=="Yes")

#formula<-formula.text("Taula01B",y="G_DIABETIC",taulavariables = conductor,dt=TAULA_PLANA_exc2) 


#descrTable(formula,
#                 method =2,
#                 Q1 = 0, Q3 = 1,
#                 data=TAULA_PLANA_exc2,
#                 max.xlev = 100, 
#                 show.p.overall=FALSE,
#                 show.n = T,
#                 hide.no="No",simplify=F) %>% 
#  export2md(caption="**TABLA 1b. Registros de pacientes ingresados: Demográficos, datos del episodio del ingreso, datos del episodio de urgencias previo, si ha habido, datos del paso por UCI, si ha habido.SOLO URGENCIAS.**")


#table1::table1(~EDAD.AGE|G_DIABETIC, 
#               data = TAULA_PLANA_exc2,caption="Taula 1b",
#               render.continuous=c(.="Mean (SD)", .="Median [Q1, Q3]"))

```

```




&nbsp;
<hr />
<p style="text-align: center;">A work by $Jordi Real$ $Rai Puig$ </a></p>
<p style="text-align: center;">$Llepali System$ </a></p>
<p style="text-align: center;"><span style="color: #808080;"><em><https://github.com/USR-DAPCAT/></em></span></p>


